<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>宣传品（资料）制作申请</title>
    <script src="assets/js/jquery-3.2.1.js"></script>
    <script src="assets/bootstrap/js/bootstrap.js"></script>
    <script src="assets/js/dialog/jquery.hDialog.js"></script>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="assets/ownCss/view.css">
    <script src="assets/js/dialog/jquery.hDialog.js"></script>
    <script src="assets/layer/layer.js"></script>
    <script src="assets/js/Clock.js"></script>
</head>
<body>
<!--布局设置-->
<div class="container">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <!--导航栏-->
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                            data-target="#bs-example-navbar-collapse-1"><span
                            class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span
                            class="icon-bar"></span><span class="icon-bar"></span></button>
                    <a class="navbar-brand" href="#">
                        <img alt="Brand" style="max-width:40px;margin-top:-10px;" src="picture/nav_fish.svg">
                    </a>
                    <a class="navbar-brand" href="home.html">宣传管理</a>
                </div>
                <!--下拉菜单-->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <!--宣传信息发布-->
                        <li class="dropdown ">
                            <a href="#" class="dropdown-toggle " data-toggle="dropdown">宣传信息发布<strong
                                    class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="xcxxfbsq.html">宣传信息发布申请 </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="xcxxfbcx.html">宣传信息发布查询 </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="xcxxlbgl.html">宣传信息发布管理 </a>
                                </li>
                                <li class="divider">
                                <li>
                                    <a href="xcxxfbtj.html">宣传信息发布统计 </a>
                                </li>
                            </ul>
                        </li>
                        <!--宣传品(资料)制作-->
                        <li class="dropdown ">
                            <a href="#" class="dropdown-toggle " data-toggle="dropdown">宣传品(资料)制作<strong
                                    class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="xcpzzsq.html">宣传品(资料)制作申请 </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="xcpzhzcx.html">宣传品(资料)制作查询 </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="xcpzhiztj.html">宣传品(资料)制作统计 </a>
                                </li>
                            </ul>
                        </li>
                        <!--宣传物资领用-->
                        <li class="dropdown ">
                            <a href="#" class="dropdown-toggle " data-toggle="dropdown">宣传物资领用<strong
                                    class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="xcwzlysq.html">宣传物资领用申请 </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="xcwzlycx.html">宣传物资领用查询 </a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="xcwzlytj.html">宣传物资领用统计 </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
            <!--标题 h4居中-->
            <h4 class="text-center">
                <b>宣传品（资料）制作申请</b>
            </h4>
            <!--状态 h6靠左-->
            <div style="color: #2aabd2;float:left">
                <h6 style="float: left">
                    状态:
                </h6>
                <!--审批/待审批-->
                <h6 style="float: left" id="">
                    待审批
                </h6>
            </div>

            <!--提交申请表单-->
            <form>

                <table class="table table-bordered "
                       style="margin:0px; padding:0px;text-align: center;vertical-align: middle">
                    <tr>
                        <td class="info" style="width: 16%">
                            申请部门
                        </td>
                        <td>
                            血源管理科
                        </td>
                        <td class="info tablewidth">
                            申请时间
                        </td>
                        <td>
                            <span id="clock"></span>
                        </td>
                    </tr>

                    <tr>
                        <td class="info">
                            申请人
                        </td>
                        <td >
                            张明磊
                        </td>
                        <td class="info">
                            联系电话
                        </td>
                        <td id=" ">
                            15017760683
                        </td>
                    </tr>

                    <tr>
                        <td class="info">
                            *标题
                        </td>
                        <td colspan="3">
                            <input type="text" placeholder="请输入不超过15字符" maxlength="15" id="title"
                                   style="width: 100%;height: 95%">
                        </td>
                    </tr>

                    <tr>
                        <td style="vertical-align: middle" colspan="4">
                            请在以下表格中填写宣传品（资料）内容
                        </td>
                    </tr>

                    <tr>
                        <td class="info" colspan="4">
                            <div class="demo">
                                <a onclick="add_row()"><i class="glyphicon glyphicon-plus"></i>&nbsp;添加</a>
                                <a href="javascript:;"><i class="glyphicon glyphicon-minus"></i>&nbsp;删除</a>
                            </div>
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered "
                       style="margin:0px; padding:0px;text-align: center;vertical-align: middle">

                    <tbody id="tabletr">
                    <tr>
                        <td style="width: 5%;text-align:center;vertical-align:middle" rowspan="8">
                            <div style="margin:auto">
                                <input type="checkbox">
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td class="info" style="width: 16%">
                            宣传品类别
                        </td>
                        <td>
                            <select id="leibie_choose" style="width: 100%">
                                <option value="宣传（献血、知识）手册">宣传（献血、知识）手册</option>
                                <option value="电梯、海报广告">电梯、海报广告</option>
                                <option value="电视媒体视频（材料）">电视媒体视频（材料）</option>
                                <option value="宣传、活动（指引）单张">宣传、活动（指引）单张</option>
                                <option value="其他">其他</option>
                            </select>
                        </td>
                        <td class="info">
                            宣传品名称
                        </td>
                        <td>
                            <input type="text" id="name" style="width: 100%;height: 95%">
                        </td>
                    </tr>

                    <tr>
                        <td class="info" style="width: 16%">
                            制作方式
                        </td>
                        <td id="makestyle" colspan="3">
                            <div style="float: left">
                                <input name="zzfs" type="radio" value="内部制作"/>内部制作
                                <input name="zzfs" type="radio" value="广告公司制作"/>广告公司制作
                                <input name="zzfs" type="radio" value="内部与广告公司制作"/>内部与广告公司制作
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td class="info">
                            要求完成时间
                        </td>
                        <td>
                            <input type="date" id="finishtime" style="width: 100%;height: 95%">
                        </td>
                        <td class="info">
                            规格
                        </td>
                        <td>
                            <input type="text" id="standard" style="width: 100%;height: 95%">
                        </td>
                    </tr>

                    <tr>
                        <td class="info">
                            单位
                        </td>
                        <td>
                            <input type="text" id="company" style="width: 100%;height: 95%">
                        </td>
                        <td class="info">
                            制作数量
                        </td>
                        <td>
                            <input type="text" id="count" style="width: 100%;height: 95%" onkeyup="sum(this)">
                        </td>
                    </tr>

                    <tr>
                        <td class="info">
                            广告公司名称
                        </td>
                        <td colspan="3">
                            <input type="text" id="companyName" style="width: 100%;height: 95%">
                        </td>
                    </tr>

                    <tr>
                        <td class="info">
                            广告公司联系人
                        </td>
                        <td>
                            <input type="text" id="companyLinkman" style="width: 100%;height: 95%">
                        </td>
                        <td class="info">
                            广告公司联系方式
                        </td>
                        <td>
                            <input type="text" id="companyPhone" style="width: 100%;height: 95%">
                        </td>
                    </tr>

                    <tr>
                        <td class="info">
                            费用（元）
                        </td>
                        <td colspan="3">
                            <input type="text" id="price" style="width: 100%;height: 95%" onkeyup="sum(this)">
                        </td>
                    </tr>
                    </tbody>

                </table>

                <table class="table table-bordered " style="text-align: center;vertical-align: middle">
                    <tr>
                        <td class="info" style="width: 16%">
                            总费用（元）
                        </td>
                        <td>
                            <input disabled="disabled" type="text" id="totalPrice" style="width: 100%;height: 95%">
                        </td>
                        <td class="info" style="width: 27%">
                            负责人
                        </td>
                        <td>
                            <input type="text" id="manager" style="width: 100%;height: 95%">
                        </td>
                    </tr>

                    <tr>
                        <td class="info" style="vertical-align: middle">
                            备注
                        </td>
                        <td colspan="3">
                            <!--ie兼容问题解决断行问题防止自动变为在一行word-break、word-wrap”控制断行)-->
                            <textarea id="beizhu" placeholder=""
                                      style="width: 100%;height: 60px;overflow: auto;word-break: break-all"></textarea>
                        </td>
                    </tr>

                    <tr>
                        <td class="info" style="vertical-align: middle">
                            附件
                        </td>
                        <td colspan="3">
                            <!--添加附件-->
                            <div id="wrapper">
                                <div class="box">
                                    <div class="demo">
                                        <a href="javascript:;" style="float: left"
                                           class="rotateInDownLeft dialog demo3"><i
                                                class="glyphicon glyphicon-plus"></i>&nbsp;添加</a>
                                        <div style="float:left;margin-top:1%;margin-left: 1%;color: red" id="filePath">
                                            暂无文件
                                        </div>
                                        <br>
                                    </div>
                                    <div style="margin-top: 30px;margin-left: 30px">
                                        <div style="float:left" id="fileName"></div>
                                        <a href="" id="openfile" download="">
                                            <div style="float: left;margin-left: 10px" id="openfont">
                                            </div>
                                        </a>
                                    </div>
                                    <!--<div style="float:left;margin-left: 1%" id="fileUrl"></div>-->
                                    <!--<a href="" id="openfile" download="">打开Open</a>-->
                                    <div id="HBox">
                                        <form action="" method="post" onsubmit="return false;">
                                            <form></form>
                                            <div style="text-align: center">
                                                <form id="uploadForm">
                                                    <br>
                                                    <p><input type="file" name="file"/></p>
                                                    <div id="preview"
                                                         style=" width:100%; border: 1px solid #fe0000; color: #5e89e9">
                                                        备注：多文件请压缩上传（.zip .rar）
                                                    </div>
                                                    <br>
                                                    <input type="button" value="确定上传" onclick="doUpload()"/>
                                                </form>
                                            </div>
                                        </form>
                                    </div><!-- HBox end -->
                                </div><!-- box end -->
                            </div><!-- wrapper end -->
                            <!--添加附件END-->
                        </td>
                    </tr>

                    <tr>
                        <td class="info" style="vertical-align: middle">
                            领导审批意见
                        </td>
                        <td colspan="3">

                        </td>
                    </tr>
                </table>
                <!--&lt;!&ndash;左下意见&ndash;&gt;-->
                <!--<table class="table table-bordered " style="width:49%;vertical-align: middle;float: left">-->
                <!--<tr>-->
                <!--<td class="info">-->
                <!--<div style="float: left">-->
                <!--选择常用意见：&nbsp;-->
                <!--</div>-->
                <!--<div style="float: left">-->
                <!--<select id="ispass_choose" style="width: 100%">-->
                <!--<option value="通过">通过</option>-->
                <!--<option value="不通过">不通过</option>-->
                <!--</select>-->
                <!--</div>-->
                <!--</td>-->
                <!--</tr>-->
                <!--<tr>-->
                <!--<td class="info">-->
                <!--<div style="float: left">-->
                <!--填写审批意见：&nbsp;-->
                <!--</div>-->
                <!--<div style="float: right">-->
                <!--<a href="">-->
                <!--添加为常用意见-->
                <!--</a>-->
                <!--</div>-->
                <!--<textarea id="advise" placeholder=""-->
                <!--style="width: 100%;height: 60px;overflow: auto;word-break: break-all"></textarea>-->
                <!--</td>-->
                <!--</tr>-->
                <!--</table>-->
                <!--右下提交领导-->
                <table class="table table-bordered " style="width:100%;vertical-align: middle;text-align: center;float: left">
                    <tr>
                        <td class="info" colspan="2">
                            功能操作：&nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td class="info" style="vertical-align: middle">
                            <div style="margin-top: 0px">
                                <button onclick="tjbl()" type="button" class="btn btn-sm"
                                        style="background-color: #dca7a7;width: 49%;float: left;"
                                        title="送科室领导"><i class="glyphicon glyphicon-pencil" style="color: yellow"
                                                         aria-hidden="true"></i><i style="color: #761c19">送科室领导</i>
                                </button>
                                <button onclick="tjbl()" name="parentIframe" type="button" class="btn btn-sm"
                                        style="width: 49%;float: right"
                                        title="送部门领导"><i class="glyphicon glyphicon-pencil" style="color: yellow"
                                                         aria-hidden="true"></i><i style="color: #761c19">送部门领导</i>
                                </button>
                            </div>
                            <div style="margin-top: 50px;margin-bottom: 0px">
                                <button onclick="tjbl()" name="parentIframe" type="button" class="btn btn-sm"
                                        style="background-color: #67b168;width: 49%;float: left"
                                        title="送中心领导"><i class="glyphicon glyphicon-pencil" style="color: yellow"
                                                         aria-hidden="true"></i><i style="color: #761c19">送中心领导</i>
                                </button>
                                <button onclick="tjbl()" name="parentIframe" type="button" class="btn btn-sm"
                                        style="background-color: khaki;width: 49%;float: right"
                                        title="退回拟稿人"><i class="glyphicon glyphicon-circle-arrow-left"
                                                         style="color: yellow" aria-hidden="true"></i><i
                                        style="color: #761c19">退回拟稿人</i>
                                </button>
                            </div>
                        </td>
                        <td class="info">
                            <div style="margin-top: 15px">
                                <a href="">
                                    查看流程图
                                </a>
                                <br> <br>
                                <a href="">
                                    查看流程跟踪
                                </a>
                            </div>
                        </td>
                    </tr>
                </table>

                <!--直接提交页面按钮-->
                <div style="text-align:center;">
                    <button id="btn-save" type="button" class="btn btn-sm" style="background-color: #68e1e9;"
                            title="提交"><i class="glyphicon glyphicon-pencil" style="color: yellow"
                                          aria-hidden="true"></i><i style="color: #761c19">提交</i>
                    </button>
                </div>
            </form>
            <!--提交申请表单END-->

        </div>
    </div>
</div>
<!--表格点击添加按钮新增一行-->
<script>
    function add_row() {
        t = '<tr>' +
            '<td style="width: 5%;text-align:center;vertical-align:middle" rowspan="8">' +
            '<div style="margin:auto">' +
            '<input type="checkbox">' +
            '</div>' +
            '</td>' +
            '</tr>' +

            '<tr>' +
            '<td class="info" style="width: 16%">' +
            '宣传品类别' +
            ' </td>' +
            ' <td>' +
            ' <select id="leibie_choose" style="width: 100%">' +
            ' <option value="宣传（献血、知识）手册">宣传（献血、知识）手册</option>' +
            ' <option value="电梯、海报广告">电梯、海报广告</option>' +
            ' <option value="电视媒体视频（材料）">电视媒体视频（材料）</option>' +
            ' <option value="宣传、活动（指引）单张">宣传、活动（指引）单张</option>' +
            ' <option value="其他">其他</option>' +
            ' </select>' +
            '</td>' +
            '<td class="info">' +
            '宣传品名称' +
            '</td>' +
            '<td id=" ">' +
            '</td>' +
            '</tr>' +

            '<tr>' +
            '<td class="info" style="width: 16%">' +
            '制作方式' +
            '</td>' +
            '<td colspan="3">' +
            '<div style="float: left">' +
            '<input name="zzfs" type="radio" value=""/>' + '内部制作' +
            '<input name="zzfs" type="radio" value=""/>' + '广告公司制作' +
            '</div>' +
            '</td>' +
            '</tr>' +

            '<tr>' +
            '<td class="info">' +
            '要求完成时间' +
            '</td>' +
            '<td>' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '<td class="info">' +
            '规格' +
            '</td>' +
            '<td>' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '</tr>' +

            '<tr>' +
            '<td class="info">' +
            '单位' +
            '</td>' +
            '<td>' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '<td class="info">' +
            '制作数量' +
            '</td>' +
            '<td>' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '</tr>' +

            '<tr>' +
            '<td class="info">' +
            '广告公司名称' +
            '</td>' +
            '<td colspan="3">' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '</tr>' +

            '<tr>' +
            '<td class="info">' +
            '广告公司联系人' +
            '</td>' +
            '<td>' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '<td class="info">' +
            '广告公司联系方式' +
            '</td>' +
            '<td>' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '</tr>' +

            '<tr>' +
            '<td class="info">' +
            '费用(元)' +
            '</td>' +
            '<td colspan="3">' +
            '<input type="text" id=" " style="width: 100%;height: 95%">' +
            '</td>' +
            '</tr>';
        $("#tabletr").append(t);
    }
</script>
<!--弹出提交办理审批窗口-->
<script>
    function tjbl() {
        layer.open({
            type: 2,
            skin: 'layui-layer-lan',
            title: '提交办理',
            fix: false,
            shadeClose: true,
            maxmin: true,
            area: ['70%', '83%'],
            content: 'tjbl.html',
        });
    }
</script>

<!--计算总费用-->
<script type="text/javascript">
    function sum(obj) {
        var count = document.getElementById("count");
        var price = document.getElementById("price");
        var totalPrice = document.getElementById("totalPrice");
        if (count.value === "" || price.value === "") {
            return;
        }

        totalPrice.value = (parseFloat(count.value) * parseFloat(price.value)).toFixed(2);
    }
</script>

<!--上传附件弹出窗口-->
<script src="assets/js/dialog/jquery.hDialog.js"></script>
<script>
    var filePath;
    var fileName;
    function doUpload() {
        var formData = new FormData($("#uploadForm")[0]);

        $.ajax({
            url: '/upload/uploadfile',
            type: 'POST',
            data: formData,
            dataType: 'JSON',
            async: false,
            cache: false,
            contentType: false,
            processData: false,

            success: function (data) {
                if (data != "null") {
                    filePath = data.url;
                    fileName = data.fileName;
                    var getfileresult = "附件已上传服务器";
                    var getfileName = data.fileName;
                    var getfileurl = data.url;
                    var openfont = "Open";
                    var downfile = document.getElementById("openfile");
                    downfile.href = data.url;
                    downfile.download = data.url;
                    $("#filePath").eq(0).html(getfileresult);
                    $("#fileName").eq(0).html(getfileName);
                    $("#fileUrl").eq(0).html(getfileurl);
                    $("#openfont").eq(0).html(openfont);
                    $.tooltip('上传附件成功，请返回继续操作', 2000, true);
//                    alert('上传附件成功，图片地址为:'+data);
                }
                else {
                    $.tooltip('上传附件失败，请选择附件');
//                    alert('上传附件失败');
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                $.tooltip('上传附件失败');
//                alert('上传失败！');
            }
        });
    }
    $(function () {
        var $el = $('.dialog');
        $el.hDialog();
        //改变宽和高
        $('.demo3').hDialog({width: 400, height: 150});
    });
</script>

<!--页面内容保存数据库-->
<script src="assets/js/dialog/jquery.hDialog.js"></script>
<script>
    var clock = new Clock();
    clock.display(document.getElementById("clock"));
    $("#btn-save").bind('click', function () {
        var title = $("#title").val();
        var leibiechoose = $("#leibie_choose").val();
        var name = $("#name").val();
        var makestyle = $('input:radio[name="zzfs"]:checked').val();
        var finishtime = $("#finishtime").val();
        var standard = $("#standard").val();
        var company = $("#company").val();
        var count = $("#count").val();
        var companyName = $("#companyName").val();
        var companyLinkman = $("#companyLinkman").val();
        var companyPhone = $("#companyPhone").val();
        var price = $("#price").val();
        var totalPrice = $("#totalPrice").val();
        var beizhu = $("#beizhu").val();
//        var commonAdvise = $("#commonAdvise option:selected").val();
//        var approvalAdvise = $("#approvalAdvise").val();
        var manager = $("#manager").val();
        var filepath = filePath;
        var filename = fileName;
        var clock = new Clock();
        var applydate = clock.toSimpleDate();
        var xcpzz = {
            title: title,
            leibie: leibiechoose,
            name: name,
            makestyle: makestyle,
            finishtime: finishtime,
            standard: standard,
            company: company,
            count: count,
            companyName: companyName,
            companyLinkman: companyLinkman,
            companyPhone: companyPhone,
            price: price,
            totalprice: totalPrice,
            beizhu: beizhu,
            commonAdvise: "待审批",
//            approvalAdvise: approvalAdvise,
            manager: manager,
            filename: filename,
            applydate: applydate,
            filepath: filepath
        };
        if (title != "" && title.value != "") {
            $.ajax({
                url: "xcp",
                method: "POST",
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(xcpzz),
                dataType: "json",
                success: function (data) {
                    alert("保存成功！");
                    parent.location.href = 'xcpzhzcx.html'
                },
                error: function (message) {
                    alert("保存失败");
                }
            });
        }
        else {
            $.tooltip('请填写标题');
            return false;
        }
    });
</script>
</body>
</html>